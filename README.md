# ë””ì§€í„¸íŠ¸ìœˆ ë¡œë´‡ ìë™í™” ì‹œë®¬ë ˆì´ì…˜ ì‹œìŠ¤í…œ êµ¬í˜„ í”„ë¡œì íŠ¸

![Tumbnail](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdna%2Fbem3I6%2FdJMcaiuUShO%2FAAAAAAAAAAAAAAAAAAAAAPLtGiC6eyGGCSR8b-TmPBZTQXyvgqP9pe2PeYOwzeHQ%2Fimg.png%3Fcredential%3DyqXZFxpELC7KVnFOS48ylbz2pIh7yKj8%26expires%3D1764514799%26allow_ip%3D%26allow_referer%3D%26signature%3DZ9GaePCN5lV%252FuoDymPCXFJCwF%252FI%253D)

<br>

## ğŸ—‚ï¸ ëª©ì°¨

### 1. [í”„ë¡œì íŠ¸ ê°œìš”](#-í”„ë¡œì íŠ¸-ê°œìš”)

### 2. [íŒ€ êµ¬ì„± ë° ì—­í• ](#-íŒ€-êµ¬ì„±-ë°-ì—­í• )

### 3. [ê¸°ìˆ  ìŠ¤í…](#-ê¸°ìˆ -ìŠ¤í…)

### 4. [í•µì‹¬ ê¸°ëŠ¥ ë¡œì§](#-í•µì‹¬-ê¸°ëŠ¥-ë¡œì§)

### 5. [ì‹œì—° ì˜ìƒ](#-ì‹œì—°-ì˜ìƒ)

### 6. [í‰ê°€ ë° í”¼ë“œë°±](#-í‰ê°€-ë°-í”¼ë“œë°±)

<br>

## ğŸ“ƒ í”„ë¡œì íŠ¸ ê°œìš”

### Isaac Sim í™œìš©í•œ ê±°ë¦¬ ê¸°ë°˜ Nav2 Object Auto Attach ì‹œìŠ¤í…œ êµ¬í˜„

ë³¸ í”„ë¡œì íŠ¸ëŠ” NVIDIA Isaac Sim í™˜ê²½ì—ì„œ Nova Carter ë¡œë´‡ì´ Nav2 ììœ¨ì£¼í–‰ì„ ìˆ˜í–‰í•œ ë’¤,ë¡œë´‡ì´ íŠ¹ì • ë¬¼ì²´ì— ì ‘ê·¼í•˜ë©´ ìë™ìœ¼ë¡œ ë¡œë´‡ì— ë¶€ì°©ë˜ë„ë¡ í•˜ëŠ” Distance-Based Attach ì‹œìŠ¤í…œì„ êµ¬í˜„í•œ ì‘ì—….   
ë˜í•œ ì‚¬ìš©ì ì •ì˜ Office ëª¨ë¸ì—ì„œ Occupancy Map ìƒì„± ë° Rvizë¥¼ í†µí•œ Nav2 Goal ì„¤ì • ê¸°ëŠ¥ì„ ì œê³µ.


#### ğŸ“† ê°œë°œ ê¸°ê°„ : 2025ë…„ 11ì›” 17ì¼ ~ 2025ë…„ 11ì›” 21ì¼


<br>

## ğŸ§‘â€ğŸ’» íŒ€ êµ¬ì„± ë° ì—­í• 


| ì¡°ì› | ì—­í•  | ë‹´ë‹¹ ì—…ë¬´ |
|:---------:|:---------:|:--------:|
| ê°•ë™í˜  | íŒ€ì¥  | Officeroom Design, nav2 Nova Carter load ë° Ros2 Bridge í™œì„±í™” 
| ê¹€ê°‘ë¯¼ | íŒ€ì› | Custom Mapì— ë§ì¶° Nav2 Nova Carter ìµœì í™”, Tableê³¼ Box ê°„ Attach ê¸°ëŠ¥ êµ¬í˜„ ë° ë””ë²„ê¹… |
| ê¹€íš¨ì› | íŒ€ì› | Custom Mapì˜ Occupancy Map ìƒì„±, Boxì™€ nav2 Nova Carterê°„ Attach ê¸°ëŠ¥ ë° Reparent êµ¬í˜„ |
| í™©ìˆ˜ë¹ˆ | íŒ€ì› | Custom Occupancy Map ìµœì í™” ë° ì„œë²„ ë“±ë¡, Boxì™€ Nav2 Nova Carterê°„ Attach ê¸°ëŠ¥ êµ¬í˜„ |
| í™©í˜œì¸ | íŒ€ì› | Custom Officeroom USD file ìƒì„±, ì‹œë®¬ë ˆì´ì…˜ í™˜ê²½ ì„¸íŒ… ë° Rvizë¥¼ í†µí•œ map ì£¼í–‰ ê²€ì¦ |

<br>

## ğŸ•¹ï¸ ê¸°ìˆ  ìŠ¤íƒ

- Python
- NVIDIA Isaac Sim
- ROS2
- Nav2
- Rivz2

<br>

## â­ í•µì‹¬ ê¸°ëŠ¥ ë¡œì§

### Isaac Sim Script Editorë¥¼ ì‚¬ìš©í•˜ì—¬ í•µì‹¬ ê¸°ëŠ¥ ì‹¤í–‰  

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdna%2Fc1i2Xo%2FdJMcadNT3Sp%2FAAAAAAAAAAAAAAAAAAAAAEVlAytKXxEcfE6cZ11LyXG02o8TEWPAew9FqiZJ5z6S%2Fimg.png%3Fcredential%3DyqXZFxpELC7KVnFOS48ylbz2pIh7yKj8%26expires%3D1764514799%26allow_ip%3D%26allow_referer%3D%26signature%3DX7EocS9%252FqtJdiqaRxDsPUuNUrl4%253D)

```python
import omni
from pxr import UsdGeom, Sdf, Gf, Usd, UsdPhysics


stage = omni.usd.get_context().get_stage()

BASE_LINK_PATH = "/World/Nova_Carter_ROS/chassis_link/base_link"
BOX_01 = "/World/Cardbox_A1/Cardbox_A1"
BOX_02 = "/World/Cardbox_D3/Cardbox_D3"
TARGET_01 = "/World/officewemadeday2/officeroomwemade/FlatGrid/GroundPlane/destinations/Danny_01/DannyTable"
TARGET_02 = "/World/officewemadeday2/officeroomwemade/FlatGrid/GroundPlane/destinations/Danny_02/DannyTable"
BOX_01_JOINT_PATH = f"{BOX_01}/FixedJoint"
BOX_02_JOINT_PATH = f"{BOX_02}/FixedJoint"
TARGET_01_JOINT_PATH = f"{TARGET_01}/FixedJoint"
TARGET_02_JOINT_PATH = f"{TARGET_02}/FixedJoint"
limit_distance = 1.5

def get_world_position(prim_path):
    prim = stage.GetPrimAtPath(prim_path)
    if not prim.IsValid():
        return None
    xform = UsdGeom.Xformable(prim)
    mat = xform.ComputeLocalToWorldTransform(Usd.TimeCode.Default())
    return mat.ExtractTranslation()

# ìƒì íšë“ ìƒíƒœ (ìƒìì™€ ë¡œë´‡ ë¶€ì°© ì—¬ë¶€)
is_attached = False
# target_01 ìƒì ì „ë‹¬ ì™„ë£Œ ìƒíƒœ
target_01_state = False
# target_02 ìƒì ì „ë‹¬ ì™„ë£Œ ìƒíƒœ
target_02_state = False

def on_update(dt):
    global is_attached
    global target_01_state
    global target_02_state

    # ë¡œë´‡, ìƒì, ëª©ì ì§€ ìœ„ì¹˜ ë°ì´í„° ì •ë³´
    robot_pos = get_world_position(BASE_LINK_PATH)
    box_01_pos  = get_world_position(BOX_01)
    box_02_pos  = get_world_position(BOX_02)
    target_01_pos = get_world_position(TARGET_01)
    target_02_pos = get_world_position(TARGET_02)


    if robot_pos is None or target_01_pos is None or target_02_pos is None:
        print("object is not found")
        return

    # ìƒì, ëª©ì ì§€ ì‚¬ì´ì˜ ê±°ë¦¬ ê³„ì‚°
    box_01_dist = (box_01_pos - robot_pos).GetLength()
    box_02_dist = (box_02_pos - robot_pos).GetLength()
    target_01_dist = (target_01_pos - robot_pos).GetLength()
    target_02_dist = (target_02_pos - robot_pos).GetLength()

    # box1 ì „ë‹¬ ì™„ë£Œ x, 
    # target_01ì™€ robot ì‚¬ì´ì˜ ê±°ë¦¬ê°€ limit_distance ì´í•˜
    # ìœ— ì¡°ê±´ì„ ë§Œì¡±í•œ ê²½ìš° box_01ë¥¼ target_01ì— ë¶€ì°© (ìƒì ì „ë‹¬ ì™„ë£Œ)
    if not target_01_state and target_01_dist < limit_distance:
        stage.RemovePrim(BOX_01_JOINT_PATH)

        input0 = Sdf.Path(TARGET_01)
        input1 = Sdf.Path(BOX_01)
        joint_prim = UsdPhysics.FixedJoint.Define(stage, TARGET_01_JOINT_PATH)
        joint_prim.CreateBody0Rel().SetTargets([input0])
        joint_prim.CreateBody1Rel().SetTargets([input1])

        is_attached = False
        target_01_state = True

        print("ğŸ“¦ box1 complete!!")

    # box2 ì „ë‹¬ ì™„ë£Œ x, 
    # target_02ì™€ robot ì‚¬ì´ì˜ ê±°ë¦¬ê°€ limit_distance ì´í•˜
    # ìœ— ì¡°ê±´ì„ ë§Œì¡±í•œ ê²½ìš° box_01ë¥¼ target_01ì— ë¶€ì°© (ìƒì ì „ë‹¬ ì™„ë£Œ)
    elif not target_02_state and target_02_dist < limit_distance:
        stage.RemovePrim(BOX_02_JOINT_PATH)

        input0 = Sdf.Path(TARGET_02)
        input1 = Sdf.Path(BOX_02) 
        joint_prim = UsdPhysics.FixedJoint.Define(stage, TARGET_02_JOINT_PATH)
        joint_prim.CreateBody0Rel().SetTargets([input0])
        joint_prim.CreateBody1Rel().SetTargets([input1])

        is_attached = False
        target_02_state = True
        ì£¼ìš”-ê¸°ëŠ¥
        print("ğŸ“¦ box2 complete!!")

    else:
        if not is_attached:
            # box_01 ì „ë‹¬ x, 
            # box_01ì™€ robot ì‚¬ì´ì˜ ê±°ë¦¬ê°€ limit_distance ì´í•˜
            # ìœ— ì¡°ê±´ì„ ë§Œì¡±í•œ ê²½ìš° box_01ë¥¼ robotì— ë¶€ì°© (ìƒì íšë“ ì™„ë£Œ)
            if not target_01_state and box_01_dist < limit_distance:
                input0 = Sdf.Path(BASE_LINK_PATH)
                input1 = Sdf.Path(BOX_01)

                joint_prim = UsdPhysics.FixedJoint.Define(stage, BOX_01_JOINT_PATH)
                joint_prim.CreateBody0Rel().SetTargets([input0])
                joint_prim.CreateBody1Rel().SetTargets([input1])
                joint_prim.CreateLocalPos0Attr().Set(Gf.Vec3f(-0.2, 0.0, 1.0))

                print("ğŸ“¦ box1 attached!!")
                is_attached = True
                
            # box_01 ì „ë‹¬ o, 
            # box_02 ì „ë‹¬ x
            # box_02ì™€ robot ì‚¬ì´ì˜ ê±°ë¦¬ê°€ limit_distance ì´í•˜
            # ìœ— ì¡°ê±´ì„ ë§Œì¡±í•œ ê²½ìš° box_02ë¥¼ robotì— ë¶€ì°© (ìƒì íšë“ ì™„ë£Œ)
            elif target_01_state and not target_02_state and box_02_dist < limit_distance:
                input0 = Sdf.Path(BASE_LINK_PATH)
                input1 = Sdf.Path(BOX_02)

                joint_prim = UsdPhysics.FixedJoint.Define(stage, BOX_02_JOINT_PATH)
                joint_prim.CreateBody0Rel().SetTargets([input0])
                joint_prim.CreateBody1Rel().SetTargets([input1])
                joint_prim.CreateLocalPos0Attr().Set(Gf.Vec3f(-0.2, 0.0, 1.0))

                print("ğŸ“¦ box2 attached!!")
                is_attached = True


subscription = omni.kit.app.get_app().get_update_event_stream().create_subscription_to_pop(on_update)
```

<br>

## ğŸ™‰ ì‹œì—° ì˜ìƒ

![ì‹œì—° ì˜ìƒ](https://blog.kakaocdn.net/dna/cxzYb2/dJMcagKGf76/AAAAAAAAAAAAAAAAAAAAADvhfxBE9Qb5KQtPHAeulpPgV8Y0roBC2kpuq9icklOw/img.gif?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1764514799&allow_ip=&allow_referer=&signature=Kb2TjjMXJxNNieoCCUWffJbwYmY%3D)


<br>

## ğŸ”§ í‰ê°€ ë° í”¼ë“œë°±

### ì™„ì„±ë„ í‰ê°€
- ëª©í‘œì˜€ë˜ 'ì‚¬ë¬´ì‹¤ í™˜ê²½ì—ì„œì˜ ììœ¨ì£¼í–‰ ë° ë°°ì†¡ ê¸°ëŠ¥ì„ ì„±ê³µì ìœ¼ë¡œ êµ¬í˜„í•¨
- Nav2 ê¸°ë°˜ ê²½ë¡œ íƒìƒ‰, ëª©ì ì§€ ì§€ì • ì´ë™, ë°•ìŠ¤ ìë™ ë¶€ì°© ê¸°ëŠ¥ê¹Œì§€ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•¨

### ì¶”í›„ ê°œì„ ì  ë° ë³´ì™„í•  ì 
- ì´‰ë°•í•œ í”„ë¡œì íŠ¸ ê¸°ê°„ìœ¼ë¡œ ì¸í•´ Gripperë¥¼ í†µí•œ Pick & Place ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ì§€ ëª»í•˜ê³  ë‹¨ìˆœí•œ ë°•ìŠ¤ì˜ ì´ë™ìœ¼ë¡œ ê¸°ëŠ¥ì„ ë³€ê²½í•œ ì ì´ ì•„ì‰¬ì›€ìœ¼ë¡œ ë‚¨ìŒ
- Jakal ë¡œë´‡ê³¼ Franka ë¡œë´‡íŒ”ì˜ ì—°ê²°ê¹Œì§€ êµ¬í˜„í•˜ì˜€ê¸°ì— ì¶©ë¶„íˆ Pick & place ê¸°ëŠ¥ì„ êµ¬í˜„í•  ìˆ˜ ìˆì„ ê²ƒì´ë¼ê³  íŒë‹¨ë¨ 

### ìš°ë¦¬ íŒ€ì´ ì˜í•œ ë¶€ë¶„ / ì•„ì‰¬ìš´ ì 
- í”¼ë“œë°± ë°˜ì˜ ë° íŒ€ ë‚´ ì˜ì‚¬ì†Œí†µì´ ì›í™œí•˜ê²Œ ì´ë£¨ì–´ì§
- ë¬¸ì œ ìƒí™© ë°œìƒ ì‹œ ë¹ ë¥¸ ëŒ€ì²˜ì™€ ìˆ˜ì •ì´ ì´ë£¨ì–´ì§
- ë ˆí¼ëŸ°ìŠ¤ ë¶€ì¡±ìœ¼ë¡œ êµ¬í˜„ ë°©í–¥ì„ ì¡ëŠ” ë° ë§ì€ ì‹œê°„ì´ ì†Œìš”ë¨

### ëŠë‚Œ ì  ë° ê²½í—˜í•œ ì„±ê³¼
- Isaac Simê³¼ ROS2ë¥¼ ì‹¤ì œë¡œ ì—°ë™í•˜ë©´ì„œ ì‹œë®¬ë ˆì´ì…˜ ê¸°ë°˜ ë¡œë´‡ ê°œë°œ í”„ë¡œì„¸ìŠ¤ë¥¼ ì‹¤ì „ì²˜ëŸ¼ ê²½í—˜í•¨
- Nav2 ê²½ë¡œ ê³„íšì˜ êµ¬ì¡°ì™€ íŒŒì´í”„ë¼ì¸ì„ ì§ì ‘ ë‹¤ë£¨ë©° ììœ¨ì£¼í–‰ ì•Œê³ ë¦¬ì¦˜ì˜ ì „ì²´ íë¦„ì„ ì²´ë“í•¨

